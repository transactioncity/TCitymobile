<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>ECOM - HTML Mobile Template</title>
	
	<!-- font Raleway link -->  
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,300,700' rel='stylesheet' type='text/css'>
	
	<!-- all css here -->
    <!-- Path to Framework7 Library CSS-->
    <link rel="stylesheet" href="css/framework7.ios.min.css">
    <link rel="stylesheet" href="css/framework7.ios.colors.min.css">
    <link rel="stylesheet" href="css/swipebox.css">		        
	<!-- font-awesome.min CSS -->      
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="inappbrowser.css">
	<!-- style CSS -->          
	<link rel="stylesheet" href="css/style.css">
	<!-- style CSS -->          
	<link rel="stylesheet" href="css/responsive.css">
	<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
  </head>
  <body>
    <!-- Status bar overlay for fullscreen mode-->
    <div class="statusbar-overlay"></div>
    <!-- Panels overlay-->
    <div class="panel-overlay"></div>
    <!-- Left panel with reveal effect-->
    <div class="panel panel-left panel-reveal menubg">
    	<div class="menu-hoverlay">
			<div class="line"></div>
			<div class="logo-box">
				<h3><img src="img/logo2.png" alt="" /></h3>
			</div>
			<div class="mainmenu">
				<div class="row">
				<div class="col-50">
						<div class="menu">
						<a class="item-link close-panel" href="#" OnClick="parse_url('myaccount.html');">
							<img src="img/menu/menu1/4.png" alt="">
							MY ACCOUNT
							</a>
						</div>
					</div>
					<div class="col-50">
						<div class="menu">
						<a class="item-link close-panel item-content" href="#" OnClick="parse_url('add_product.html');">
							<img src="img/menu/menu1/5.png" alt="">
							POST PRODUCT</a>
						</div>
					</div>
					<div class="col-50">
						<div class="menu">
						<a class="item-link close-panel item-content" href="#" OnClick="parse_url('myorders.html');">
							<img src="img/menu/menu1/5.png" alt="">
							TRANSACTIONS </a>
						</div>
					</div>
					
					<div class="col-50">
						<div class="menu" >
						<a class="item-link close-panel item-content" href="#" OnClick="parse_url('shop-here.html');">
							<img src="img/menu/menu1/6.png" alt="">
							STORE</a>
						</div>
					</div>
					
					<div class="col-50">
						<div class="menu">
						<a class="item-link close-panel item-content" href="#" OnClick="parse_url('shopping-cart.html');">
							<img src="img/menu/menu1/8.png" alt="">
							MY CART</a>
						</div>
					</div>
					<div class="col-50">
						<div class="menu">
						<a class="item-link close-panel item-content" href="#" OnClick="parse_url('checkout.html');">
							<img src="img/menu/menu1/9.png" alt="">
							CHECKOUT</a>
						</div>
					</div>				
					
					<div class="col-50">
						<div class="menu">
						<a class="item-link close-panel item-content external" href="tel:+88-01627-600206">
							<img src="img/menu/menu1/2.png" alt="">
							BROWSE</a>
						</div>
					</div>
					<div class="col-50">
						<div class="menu">
						<a class="item-link close-panel item-content"href="#" OnClick="parse_url('logout.html');">
							<img src="img/menu/menu1/3.png" alt="">
							LOGOUT</a>
						</div>
					</div>		
				</div>
			</div>
			<!-- Menu end -->
		</div>
    </div>


    <!-- Views-->
    <div class="views">
      <!-- Your main view, should have "view-main" class-->
		<div class="view view-main">
				<!-- Top Navbar-->
			<div class="navbar">
				<div class="navbar-inner">
					<div class="left">
				  <!-- left link contains only icon - additional "icon-only" class--><a href="#" class="link icon-only open-panel"><img src="img/menu.png" alt=""></a>
					</div>
					<!-- We have home navbar without left link-->
				<div class="center sliding"><!--<script type="text/javascript" src='https://cdn.datatables.net/1.10.12/js/dataTables.bootstrap.min.js'></script>
<script type="text/javascript" src='https://cdn.datatables.net/1.10.12/js/dataTables.bootstrap.min.js'></script>
<script type="text/javascript" src='https://cdn.datatables.net/1.10.12/js/dataTables.bootstrap.min.js'></script>--><span style="color: #335e93;font-weight: bold;font-family: 'Open Sans', sans-serif; "> TransactionCity </span></div>
					<div class="right">
				
				
				<ul style="margin-right:10px">
							<li class="account_cart" ><a href="" onClick="parse_url('shopping-cart.html');"><img style="margin-top: 5px;background-color: #ffffff"    src="img/cart-top.png"   style="width:30px;height:30px;cursor:pointer;position: relative;"> </a>  </li>
							<!-- 
							-->


							<span id="current_cart_count">0</span>



							</ul>
					</div>
				
				</div>
			</div>



<div class="pages">
  <!-- Page, data-page contains page name-->
  <div data-page="shop-list" class="page">
    <!-- Scrollable page content-->
    <div class="page-content">
      <div class="content-block">
        <div class="content-block-inner">
			<div class="cartbox">
				<div class="cart-heading">
					<h2> Checkout</h2>
				</div>
				<div class="check-contenttext">
				
					  
					           
					          
					            	<div class="accorodinbox">
										<p>Select a billing address from your address book or enter a new address.</p>
										 <input style="width: 280px"  type="hidden" name="token" id="token"  value="Qw234OpI90"/>
											
												<select  style="width: 280px" id="bill_a">
												
												
												</select>
																					
												
											
										<p>Select a Shipping address from your address book or enter a new address.</p>	
											
												<select style="width: 280px" id="ship_a">
													
												
												</select>
												
												
											


					            	<div class="accorodinbox">												
										<table id="order">
											<tr>
												<th>Product Name</th>
												<th class="text-center">Price</th>
												<th class="text-center">Qty</th>
												<th class="text-center">Subtotal</th>
											</tr>
											
										
										
										
										</table>															
									</div>											
								
								
							<form id='frm' name='frm'>	
							<div id="checkout_form">
								<input type="hidden" name="checkout_user" id="checkout_user" value="">
								<input type="hidden" name="checkout_ids" id="checkout_ids" value="">
								<input type="hidden" name="checkout_addresses" id="checkout_addresses" value="primary#primary">
					       
						  
					        </div>
							 <center> <input  class="mybutton" type="submit" name="Place order" value="Place Order"></center> 
							</form>  
					</div>
				</div>
			</div>
        </div>
      </div>
    </div>
  </div>
</div>
  </div>
</div>

	<!-- Js -->
	<!-- jquery-1.11.3.min js -->         
	<script src="js/jquery-1.11.3.min.js"></script>
	<!-- Path to Framework7 Library JS --> 
    <script type="text/javascript" src="js/framework7.min.js"></script>
    <!--jquery.swipebox js --> 
    <script type="text/javascript" src="js/jquery.swipebox.js"></script>
	<!-- Path to your app js --> 
    <script type="text/javascript" src="js/my-app.js"></script>
	
	<script>
	
	/*console.log($('#checkout_ids').val());*/
$(document).ready(function(){

$('#frm').submit(function(e) {
	e.preventDefault();
	var user=$('#checkout_user').val();
	var cid=$('#checkout_ids').val();
	var address=$('#checkout_addresses').val()

	
   var url = 'http://www.transactioncity.com/stagingnew/checkoutmobile/checkout?checkout_user='+user+'&checkout_ids=['+cid+']&checkout_addresses='+address;
   var target = '_self';
   var options = 'location=yes,closebuttoncaption=Done'
   var ref = cordova.InAppBrowser.open(url, target, options);
console.log(url);
   ref.addEventListener('loadstart', loadstartCallback);
   ref.addEventListener('loadstop', loadstopCallback);
   ref.addEventListener('loadloaderror', loaderrorCallback);
   ref.addEventListener('exit', exitCallback);

   function loadstartCallback(event) {
      console.log('Loading started: '  + event.url)
   }

   function loadstopCallback(event) {
   	  ref.insertCSS({file: "inappbrowser.css"});
      console.log('Loading finished: ' + event.url)
   }

   function loaderrorCallback(error) {
      console.log('Loading error: ' + error.message)
   }

   function exitCallback()
   {
   	ref.close();
    document.location.href='myorders.html';
   }

});
var cartcount=window.localStorage["cart"];
		     
		     $("#current_cart_count").html(cartcount);
fetch_address();

});

function parse_url(val)
{
document.location.href= val;

}

function fetch_address()
{

var user_id = window.localStorage["id"];
$('#checkout_user').val(user_id);
var token = $('#token').val(); 

 $.post("http://www.transactioncity.com/stagingnew/content/Auth/fetch_address.php",
    {
     user_id:user_id,
	 token:token
    },
    function(data, status){
       
		$('#bill_a').html(data);
		$('#ship_a').html(data);
		
		fetch_prod();
  });


}  

function fetch_prod()
{
	 
var user_id = window.localStorage["id"];


	 var sub_tot = 0;
	 var cnt = 1;
	 var html = '';
	 var shipping_price=0;
	 var gtot=0;
	 var html1 = '';
	  myApp.showPreloader();
    setTimeout(function () {
        myApp.hidePreloader();
    }, 2000);
    
	 $.post("http://www.transactioncity.com/stagingnew/content/Auth/get_cart.php",
    {
     user_id:user_id
    },
    function(data, status){
    	/*console.log(data)*/
	 
	 var obj = JSON.parse(data);console.log(obj);
	 var flag=true;
	 var toc;
	 var user_currency=window.localStorage['currency'];
	 console.log('user_currency'+user_currency)
	 var supported_currency=['AUD','BRL','CAD','CZK','DKK','EUR','HKD','HUF','ILS','JPY','MYR','MXN','NOK','NZD','PHP','PLN','GBP','RUB','SGD','SEK','CHF','TWD','THB','USD'];
	 var arr=$.inArray(user_currency, supported_currency );
	if(arr==0)
		 {
		 	/*fromc='USD';*/
		 	toc=user_currency;
		 	console.log(toc);
		 	
		 }
		 else 
		 {
		 	toc='USD';
		 	myApp.alert('Your Currency '+user_currency+' is not supported by Paypal, Hence amount will be convert the US $ amount');
		 }
		


	  $.each(obj, function(key,val) {

	  
	  var pd = val.product_details;
	 
	 if(pd.currency_code==null)
	 pd.currency_code='USD';

	if(pd.currency_symbole==null)
	 pd.currency_symbol='$';

	 if(pd.currency_code == user_currency)
	 {
	 	shipping_price= parseFloat(shipping_price) + parseFloat(pd.shipping_price);
	 }
	 else
	 {
	 	shipping_price= parseFloat(shipping_price) + parseFloat(pd.in_shipping_price);
	 }
	  

	  var tot = parseFloat(val.price) * parseFloat(val.quantity);
	  
	   sub_tot = parseFloat(sub_tot) + parseFloat(tot) ;
	   gtot= parseFloat(sub_tot) + parseFloat(shipping_price);
	  
	  var html = '<tr><td>'+pd.title+'</td><td class="text-center">$'+val.price+'</td><td class="text-center">'+val.quantity+'</td><td class="text-center">$'+ tot +'</td></tr>';
	   
	 // console.log(val.product_details.shipping_price)
	   html1+=val.id+',';
	  $('#productsxyz').append(html1);
	  $('#order').append(html);
	  cnt++;
	  });
	  html1 = html1.substring(0, html1.length - 1);
	  $('#checkout_ids').val(html1);
	  $('#order').append('<tfoot><tr><td colspan="3">Subtotal </td><td colspan="1">$'+sub_tot+'</td></tr><tr><td colspan="3">Shipping &amp; Handling (Flat Rate - Fixed</td><td colspan="1">$'+shipping_price+'</td></tr><tr><td colspan="3"><b>Grand Total</b></td><td colspan="1"><b>$'+gtot +'</b></td></tr></tfoot>');
	
	});
	
}

function place_order()
{

var user_id = window.localStorage["id"];
var token = $('#token').val(); 
var ship_a = $('#ship_a').val();

$.post("http://www.transactioncity.com/stagingnew/content/Auth/place_order.php",
    {
     user_id:user_id,
	 token:token,
	 ship_a:ship_a
    },
    function(data, status){
      
	  
	   document.location.href="order-summary.html?order_id="+data;
		
  });

}
function httpGet(theUrl){
		    var xmlHttp = null;
		    xmlHttp = new XMLHttpRequest();
		    xmlHttp.open( "GET", theUrl,false);
		    xmlHttp.send( null );
		    return xmlHttp.responseText;
		    }
		    
	function currencyConverter(currency_from,currency_to,currency_input){
	    var yql_base_url = "https://query.yahooapis.com/v1/public/yql";
	    var yql_query = 'select%20*%20from%20yahoo.finance.xchange%20where%20pair%20in%20("'+currency_from+currency_to+'")';
	    var yql_query_url = yql_base_url + "?q=" + yql_query + "&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";
	    var http_response = httpGet(yql_query_url);
	    var http_response_json = JSON.parse(http_response);
	//console.log(http_response);

	    //return http_response_json.query.results.rate.Rate;
	    return parseFloat(currency_input)*http_response_json.query.results.rate.Rate;
	    }
</script>